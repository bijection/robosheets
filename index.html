<head>
	<title>RoboSheets | Spreadsheets that Work for You</title>
	<!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?1">
	<link rel="icon" type="image/png" href="/favicon-32x32.png?1" sizes="32x32">
	<link rel="icon" type="image/png" href="/favicon-16x16.png?1" sizes="16x16">
	<link rel="manifest" href="/manifest.json">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4488ff">
	<meta name="theme-color" content="#ffffff">
	<link rel="stylesheet" type="text/css" href="main.css">	
	<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
</head>
<div id='app'>
	<div id='chrome'>
		<div id='nag'>
			<div id='pricing'>Pricing</div>
			<div id='login'>Login</div>
		</div>
		<div id='tabs'>
 			<a onclick="addSheet()" data-sheet="sheet4" id='new-sheet' class='tab'>+ New Sheet</a>
		</div>
		<div id='buttons'>
			<label class='button' id='import' for='hidden-picker'>Import</label>
			<input type='file' id='hidden-picker'></input>
			<div class='button' id='export'>Export</div>
			<div class='button' id='copy'>Ctrl-C to Copy</div>
			<div class='button' id='paste'>Ctrl-V to Paste</div>
			<div class='spacer'></div>
			<div id='instructions-wrap'>
				<div class="button" id='instructions'>Instructions</div>
				<div id='instructions-modal-wrap'>
					<div id='instructions-modal'>
						<iframe src="/instructions/index.html"></iframe>
					</div>
				</div>
			</div>
		</div>
	</div>
	<iframe name='spreadsheet' id='spreadsheet' src="spreadsheet.html"></iframe>
</div>

<div id='loading-wrap'>
	<div id='loading'>Loading...</div>	
</div>

<div id='pricing-modal-wrap'>
	<div id='pricing-modal'>
		<div id='pricing-x'>&times;</div>
		<div id='pricing-title'>Pricing</div>
		<div id='pricing-intro'>
			<!-- <div>We're glad you like robosheets!</div> -->
			<div id='sign-up'>Sign up to export your work!</div>

		</div>
		<div id='pricing-modal-plans'>
			<!--<div class='plan'>
				<div class='plan-name'>Free :)</div>
				<div class='plan-price'>$0</div>
				<div class='plan-desc'>
					<div class='plan-desc-item'>Exactly what you already have</div>
				</div>
			</div>-->
			<div class='plan basic'>
				<div class='plan-name'>
					Roomba
					<div class='plan-name-sub'>Individual Seat</div>
				</div>
					<!-- <div class='plan-desc-item'></div> -->
				<div class="plan-desc">
					<div class='plan-desc-item'>Paste into other spreadsheets</div>
					<div class='plan-desc-item'>Up to <b>3</b> sheets at a time</div>
					<div class='plan-desc-item'>Up to <b>1000</b> rows per sheet</div>
				</div>	
				<div class='plan-price'>$4.58<span class='mo'>/mo</span>
				</div>
			</div>
			<div class='plan advanced'>
				<!-- <div id='popular'>Most Popular</div> -->
				<div class='plan-name'>
					Asimo
					<div class='plan-name-sub'>Individual Seat</div>
				</div>
				<div class="plan-desc">
					<div class='plan-desc-item'>Paste into other spreadsheets</div>
					<div class='plan-desc-item'>Up to <b>5</b> sheets at a time</div>
					<div class='plan-desc-item'>Up to <b>1000</b> rows per sheet</div>
					<div class='plan-desc-item'>Up to <b>200</b> columns per sheet</div>
				</div>
				<div class='plan-price'>$9.58<span class='mo'>/mo</span>
				</div>
				
			</div>
			<div class='plan enterprise'>
				<div class='plan-name'>
					Gundam
					<div class='plan-name-sub'>Unlimited Seats</div>
				</div>
				<div class="plan-desc">
					<div class='plan-desc-item'>Paste into other spreadsheets</div>
					<div class='plan-desc-item'><b>Unlimited</b> sheets</div>
					<div class='plan-desc-item'><b>Unlimited</b> rows per sheet</div>
					<div class='plan-desc-item'><b>Unlimited</b> columns per sheet</div>
					<div class='plan-desc-item'>Custom Subdomain</div>
				</div>
				<div class='plan-price'>Contact Us!</div>
			</div>
		</div>
		<div id='pricing-modal-plan-free'>
			Or keep using the free plan
		</div>
		<div id='signup-wrap'>
		<form id='signup'>
<!-- 			<div id='signup-header-wrap'>
				<div id='signup-header'>
					You're subscribing under the <b id='selected-plan'></b> plan for <b id='selected-price'></b> a month. Great choice!
				</div>
			</div>
 -->	
 			<div id='selected-plan'></div>
 			<div class='signup-question'>
				<!-- <div class='signup-label'>Where should we send your activation <b>email</b>?</div> -->
				<div class='signup-label'><b class='selected-name'></b>, a great choice!</div>
				<div class='signup-label'>What <b>email address</b> should we use to set up your account?</div>
				<input class='signup-input' type='text' placeholder="iron@giant.com" autofill='email'></input>
				<div class='signup-confirm'><div class='signup-ok'>Ok</div>or press <b>ENTER</b></div>
			</div>
			<div id='secure'>
			<div id='secure-title'>Payment Info</div>

			<div class='signup-question secure'>
				<div class='signup-label'>Please enter your <b>Credit</b> or <b>Debit Card</b> number:</div>
				<input class='signup-input' type='text' placeholder="**** **** **** 4242" data-stripe="number" autofill='cc-number'></input>
				<div class='signup-confirm'><div class='signup-ok'>Ok</div>or press <b>ENTER</b></div>
			</div>
			<div class='signup-question secure'>
				<div class='signup-label'>The <b>CVC</b> number:</div>
				<input class='signup-input' type='text' placeholder="123" data-stripe="cvc" autofill='cc-csc'></input>
				<div class='signup-confirm'><div class='signup-ok'>Ok</div>or press <b>ENTER</b></div>
			</div>
			<div class='signup-question secure'>
				<div class='signup-label'>The <b>name</b> on your card:</div>
				<input class='signup-input' type='text' placeholder="Iron Giant" data-stripe="name" autofill='cc-name'></input>
				<div class='signup-confirm'><div class='signup-ok'>Ok</div>or press <b>ENTER</b></div>
			</div>
			<div class='signup-question secure'>
				<div class='signup-label'>Your card's <b>expiration month</b>:</div>
				<input class='signup-input' type='text' placeholder="MM" data-stripe="exp_month" autofill='cc-exp-month'></input>
				<div class='signup-confirm'><div class='signup-ok'>Ok</div>or press <b>ENTER</b></div>
			</div>
			<div class='signup-question secure'>
				<div class='signup-label'>Your card's <b>expiration year</b>:</div>
				<input class='signup-input' type='text' placeholder="YY" data-stripe="exp_year" autofill='cc-exp-year'></input>
				<div class='signup-confirm'><div class='signup-ok'>Ok</div>or press <b>ENTER</b></div>
			</div>
			</div>		
			<div class='signup-question'>
				<div class='signup-label'>You're done!</div>
				<div class='signup-label'>After you confirm, we'll email you a link to set up your <b class='selected-name'></b> account:</div>
				<div class='signup-label'>Charging <span class='selected-price'></span> a month to</div>
				<div class='signup-label'>
					<div id='summary'>
						<div>
							<div class='summary-item' id='summary-number'>4242 4242 4242 4242</div><div class='summary-item' id='summary-cvc'>123</div>						
						</div>
						<div>
							<div class='summary-item' id='summary-name'>Iron Giant</div>
							<div class='summary-item' id='summary-month'>12</div>/<div class='summary-item' id='summary-year'>18</div>
						</div>
					</div>
				</div>
				<div class='signup-label'></div>

				<!-- <div class='signup-label'>Charge <b class='selected-price'></b> / month to</div> -->
				<div id='signup-submit'>Confirm</div>
			</div>	
		</form>
		</div>
	</div>
</div>

<script type="text/javascript">
	const el = name => document.createElement(name)

	const $ = selector => selector.startsWith('#')
		? document.querySelector(selector)
		: [].slice.call(document.querySelectorAll(selector))

	const first_sheet_name = 'Sheet1'

	function addSheet(name){
		let s = sheets()
		let n = s.length+1
		let newsheetname = name || 'Sheet' + n
		if(!name) while(s.indexOf(newsheetname) >=0) newsheetname = 'Sheet' + n++
		console.log('adding', newsheetname)
		s.push(newsheetname)
		sheets(s)
		loadSheet(newsheetname)
		show_sheet[newsheetname]()
	}

	let show_sheet = {}

	function loadSheet(name){
		console.log(name)
		let a = el('a')
		show_sheet[name] = () => {
			var tabs = $('#tabs').querySelectorAll('a');
			$('#spreadsheet').contentWindow.load(name)
			tabs.forEach(tab => tab.classList.toggle('active', tab === a))
			active_sheet(name)
			focussheet()
		}
		a.addEventListener('click', e => e.target === a && show_sheet[name]())
		a.tabname = name
		a.innerHTML = name
		a.className = 'tab'
		$('#tabs').insertBefore(a, $('#new-sheet'))

		let d = document.createElement('div')
		d.className = 'tab-after'
		d.innerHTML = '\u00D7'
		a.appendChild(d)

		d.addEventListener('click', () => deleteSheet(name))
	}

	function deleteSheet(name){

		$('#spreadsheet').contentWindow.clear(name)

		delete show_sheet[name]

		$('#tabs').querySelectorAll('a').forEach(tab => {
			if(tab.tabname == name) $('#tabs').removeChild(tab)
		})

		let s = sheets()
			.filter(sheet => sheet != name)

		sheets(s)

		if(!sheets().length) addSheet()

		if(active_sheet() == name) active_sheet(sheets()[sheets().length - 1])
		show_sheet[active_sheet()]()
	}

	function active_sheet(v){
		if(typeof v !== 'undefined') localStorage.activeSheet = v
		else return 'activeSheet' in localStorage ? localStorage.activeSheet : first_sheet_name
	}
	
	function sheets(v){
		if(typeof v !== 'undefined') localStorage.sheets = JSON.stringify(v)
		else return 'sheets' in localStorage ? JSON.parse(localStorage.sheets) : [first_sheet_name]
	}

	$('#spreadsheet')
	.contentWindow
	.addEventListener('DOMContentLoaded', () => {
		sheets().forEach(loadSheet)
		show_sheet[active_sheet()]()
		$('#spreadsheet').style.background = '#fff'
	})


	let focussheet = e => $('#spreadsheet').contentWindow.focus()
	window.addEventListener("load", focussheet)
	window.CRISP_READY_TRIGGER = function() {
		$crisp.on("chat:closed", focussheet)
	};
	const show_pricing = () => {
		$('#app').style.filter = 'blur(5px)';
		$('#pricing-modal-wrap').style.display = 'flex';
		$('#spreadsheet')
		.contentWindow
		.pause()
	}
	$('#pricing').addEventListener('click', show_pricing)
	$('#export').addEventListener('click', show_pricing)
	

	function hidemodals(){
		$('#app').style.filter = '';
		$('#pricing-modal-wrap').style.display = 'none';
		$('#spreadsheet')
		.contentWindow
		.resume()		
	}
	$('#pricing-modal-plan-free').addEventListener('click', hidemodals)
	$('#pricing-x').addEventListener('click', hidemodals)


	let signup_inputs = $('.signup-input')
	let signup_confirms = $('.signup-confirm')
	let signup_questions = $('.signup-question')

	signup_questions.forEach(q => q.addEventListener('click', e=> {
		if(e.target.className === 'signup-confirm') return;

		let input = q.querySelector('.signup-input')
		if (input) input.focus()
		else ungray_question(signup_questions.indexOf(q))
	}))

	signup_inputs.forEach((input, i) => {
		input.addEventListener('keydown', e => {
			console.log('e.keyCode')

			if(e.keyCode == 13) activate_input(i+1)
			else if(e.keyCode == 9){
				e.preventDefault();
				if(!e.shiftKey) activate_input(i+1)
				else activate_input(i-1)
			}
		})
		input.addEventListener('focus', e => {
			ungray_question(i)
		})
	})

	signup_confirms.forEach((confirm, i) => {
		confirm.addEventListener('click', e => activate_input(i+1))
	})

	function ungray_question(i){
		signup_questions.forEach(q => q.classList.add('gray'))
		signup_questions[i].classList.remove('gray')

		if( i > 0 && i < signup_questions.length - 1) $('#secure').classList.add('expanded')
		else $('#secure').classList.remove('expanded')
	}

	function activate_input(i){
		if( i < 0 ||  i > signup_questions.length - 1) return;

		let q = signup_questions[i],
			rect = q.getBoundingClientRect(),
			pm = $('#pricing-modal-wrap')
		
		signup_inputs.forEach(i => i.blur())
		
		let input = q.querySelector('.signup-input')
		if (!input) ungray_question(i)

		scrollTo(pm, pm.scrollTop + rect.top - innerHeight / 2 + rect.height / 2, 300, () => {
			if(input
				&& input.getBoundingClientRect().bottom < innerHeight
				&& input.getBoundingClientRect().top > 0
				){
				input.focus()
			}
			else q.focus()
		})

	}

	function select_plan(el){

		let name = el.querySelector('.plan-name').firstChild.wholeText.trim()
		let price = el.querySelector('.plan-price').firstChild.wholeText.trim()

		;[].slice.call(document.querySelectorAll('.selected-name')).forEach(b => b.innerHTML = name)
		;[].slice.call(document.querySelectorAll('.selected-price')).forEach(b => b.innerHTML = price)

		$('#signup').style.display = 'block'

		;[].slice.call(document.querySelectorAll('.plan')).forEach(el => el.classList.remove('selected'))
		el.classList.add('selected')
		// let selected = el.cloneNode(true)
		// let wrap = $('#selected-plan')
	    // if(wrap.firstChild) wrap.removeChild(wrap.firstChild);		
		// wrap.appendChild(selected)

		activate_input(0)
	}

	let basic = $('.basic')[0],
		advanced = $('.advanced')[0]
	// let plans = [].slice.call(document.querySelectorAll('.plan'))
	basic.addEventListener('click', e => select_plan(basic))
	advanced.addEventListener('click', e => select_plan(advanced))

	window.addEventListener('wheel', e => cancelAnimationFrame(current_animation))

	let current_animation
	function scrollTo(el, scrollTop, time, each){
		let startTop = el.scrollTop,
			v = (scrollTop - startTop ) / time,
			elapsed = 0,
			last_time

		function raf(f) {
			current_animation = requestAnimationFrame(f)
		}

		function tick(t){
			let dt = Math.min(t - last_time, time - elapsed)
			last_time = t
			elapsed += dt

			let now = Math.pow(elapsed / time - 1, 3) + 1

			el.scrollTop = startTop + (scrollTop - startTop) * now

			each()

			if(elapsed < time) raf(tick)
		}

		cancelAnimationFrame(current_animation)

		raf(t => {
			last_time = t
			raf(tick)
		})
	}

	Stripe.setPublishableKey('pk_test_6Eg7yBirVyhF6YvwDKhiPoPj');
	$('#signup-submit').addEventListener('click', e => {
		Stripe.card.createToken($('#signup'), (status, response) => {
			console.log(status, response)
		});
	})
</script>
<script type="text/javascript">CRISP_WEBSITE_ID = "711dddb2-aba7-4f43-ae55-1d4643bb3c7a";(function(){d=document;s=d.createElement("script");
	s.src="crispy/load.js";s.async=1;d.getElementsByTagName("head")[0].appendChild(s);})();
	// s.src="//client.crisp.im/l.js";s.async=1;d.getElementsByTagName("head")[0].appendChild(s);})();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83153710-4', 'auto');
  ga('send', 'pageview');

</script>